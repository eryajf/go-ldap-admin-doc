---
title: 配置企业微信同步
date: 2022-06-15 18:30:36
permalink: /pages/cf1698/
---

## 前言

配置 IM 同步流程如下：

1. 登陆 IM 后台创建应用，拿到对应的 key 与 secret。
2. 配置权限，根据文档说明配置对应的权限。
3. 配置字段关联关系，参考此文档配置关联关系：[详情参考](/pages/84953d/)
4. 执行同步时：先同步分组，再同步用户。如果同步失败，通过浏览器右键检查，查看失败原因。

再次提醒如下信息：

::: danger

- 请注意，操作分组或者用户同步之前，请务必检查是否已经添加了对应的字段关系，[详情参考](/pages/84953d/)
- 手动同步时，需要先同步分组列表，然后再同步员工列表，员工数据依赖分组数据。
- 默认同步到平台上的员工密码为配置文件中`user-init-password:`配置项的值。
  :::

## 感谢

平台当前已集成企业微信的集成能力，使用了如下开源库：

- [https://github.com/wenerme/go-wecom](https://github.com/wenerme/go-wecom)

## 历程

**详情参考**： [Change Log](https://github.com/eryajf/go-ldap-admin/releases/)

- `v0.2.0`：初步集成了企业微信的同步能力。

## 使用

在使用企业微信同步之前，我们先看下需要添加的配置信息：

```yaml
wecom:
  flag: "wecom" # 作为微信在平台的标识
  corp-id: "xxx" # 企业微信企业ID
  agent-id: 1111 # 企业微信中创建的应用ID
  corp-secret: "xxxx" # 企业微信中创建的应用secret
  enable-sync: false # 是否开启定时同步企业微信的任务
```

首先要在企业微信管理后台中创建应用。

### 创建应用

访问 https://work.weixin.qq.com/wework_admin/frame#apps ，登录企业微信管理后台，通过路径：`应用管理` ---> `自建` --->`创建应用`。

![image_20220615_183006](https://cdn.jsdelivr.net/gh/eryajf/tu/img/image_20220615_183006.png)

创建成功之后，我们就能拿到该应用的 AgentId，通过点击查看，可以在企业微信 APP 获取到对应的 Secret:

![image_20220617_143000](https://cdn.jsdelivr.net/gh/eryajf/tu/img/image_20220617_143000.png)

通过点击我的企业，获取到企业 ID：

![image_20220617_172947](https://cdn.jsdelivr.net/gh/eryajf/tu/img/image_20220617_172947.png)

如果配置准备完毕之后，就可以启动项目进行同步了。

### 手动同步

::: danger

- 请注意，操作分组或者用户同步之前，请务必检查是否已经添加了对应的字段关系，[详情参考](/pages/84953d/)
- 手动同步时，需要先同步分组列表，然后再同步员工列表，员工数据依赖分组数据。
- 默认同步到平台上的员工密码为配置文件中`user-init-password:`配置项的值。
  :::
