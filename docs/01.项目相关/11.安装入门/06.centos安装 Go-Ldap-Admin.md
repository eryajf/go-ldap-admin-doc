---
title: CentOS7 å®‰è£… Go-Ldap-Admin
date: 2022-08-13 16:59:32
permalink: /pages/866885/
author:
  name: maliang366359
  link: https://github.com/maliang366359
---

**æœ¬æ–‡ç”±[maliang366359](https://github.com/maliang366359)åŒå­¦è´¡çŒ®ï¼Œå†æ¬¡è¡¨ç¤ºæ„Ÿè°¢ã€‚ï¼**

> `ğŸ“¢ æ³¨æ„ï¼š`æ­¤æ–‡æ¡£ä»…ä½œä¸ºä¸€ç§éƒ¨ç½²æ–¹å¼çš„é€‰æ‹©ï¼Œä½†å› ä¸ºåŸç”Ÿéƒ¨ç½²æ­¥éª¤æ¯”è¾ƒç¹å¤ï¼Œåè€Œå¢åŠ äº†openLDAPçš„ä½¿ç”¨éš¾åº¦ã€‚å› æ­¤å¹¶ä¸æ¨èä½¿ç”¨è¿™ç§æ–¹å¼è¿›è¡Œéƒ¨ç½²ï¼Œå¤§é‡å®è·µè¯æ˜ï¼Œç›´æ¥ä½¿ç”¨dockeræ‹‰èµ·çš„openLDAPè¶³å¤Ÿä¼ä¸šå†…éƒ¨ä½¿ç”¨ã€‚

é¦–å…ˆå‡†å¤‡ä¸€å°å¹²å‡€çš„æœåŠ¡å™¨ï¼Œé…ç½®æœ€å¥½ä¸ä½äº2C4Gï¼Œå½“ç„¶å¦‚æœMySQLä¸åœ¨æœ¬æœºéƒ¨ç½²ï¼Œé‚£å¯ä»¥å°†é…ç½®é™ä¸º1C2Gã€‚

## å®‰è£…æ•°æ®åº“

### å®‰è£…MySQLï¼š5.7æ•°æ®åº“

ä¸€ã€å®‰è£…YUM Repo

1ã€ç”±äºCentOS çš„yumæºä¸­æ²¡æœ‰mysqlï¼Œéœ€è¦åˆ°mysqlçš„å®˜ç½‘ä¸‹è½½yum repoé…ç½®æ–‡ä»¶ã€‚

å®˜ç½‘åœ°å€æ˜¯ï¼šhttps://dev.mysql.com/downloads/repo/yum/

æœ€æ–°çš„æºä¸‹è½½å‘½ä»¤ï¼š

```sh
wget https://dev.mysql.com/get/mysql80-community-release-el7-5.noarch.rpm
```


2ã€ç„¶åè¿›è¡Œrepoçš„å®‰è£…ï¼š

```sh
rpm -ivh mysql80-community-release-el7-5.noarch.rpm
```

æ‰§è¡Œå®Œæˆåä¼šå¯ä»¥æŸ¥çœ‹æœ¬æœºå¯ç”¨æ•°æ®åº“ç‰ˆæœ¬

```sh
yum repolist all | grep mysql
```

å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦ï¼Œå…³é—­ï¼Œæˆ–è€…å¼€å¯æƒ³è¦çš„ç‰ˆæœ¬

```sh
# å…³é—­8.0
yum-config-manager --disable mysql80-community

# å¼€å¯5.7
yum-config-manager --enable mysql57-community
```

äºŒã€ä½¿ç”¨yumå‘½ä»¤å³å¯å®Œæˆå®‰è£…

1ã€å®‰è£…å‘½ä»¤ï¼š

```sh
yum install mysql-server
```

2ã€å¯åŠ¨msyqlï¼š

```sh
systemctl start mysqld
```

3ã€è·å–å®‰è£…æ—¶çš„ä¸´æ—¶å¯†ç ï¼ˆåœ¨ç¬¬ä¸€æ¬¡ç™»å½•æ—¶å°±æ˜¯ç”¨è¿™ä¸ªå¯†ç ï¼‰ï¼š

```sh
grep 'temporary password' /var/log/mysqld.log
```

 ç™»å½•ä¹‹åï¼Œå¿…é¡»è¦æ”¹ä¸€æ¬¡å¯†ç ï¼Œå¯†ç å¿…é¡»è®¾ç½®å¼ºå¯†ç 

```sh
alter user 'root'@'localhost' identified by 'Eryajf@123';
```


4ã€å€˜è‹¥æ²¡æœ‰è·å–ä¸´æ—¶å¯†ç ï¼Œåˆ™åˆ é™¤åŸæ¥å®‰è£…è¿‡çš„mysqlæ®‹ç•™çš„æ•°æ®

```sh
rm -rf /var/lib/mysql
```

5ã€å†å¯åŠ¨mysql

```sh
systemctl start mysqld #å¯åŠ¨MySQL
```

6ã€åˆ›å»ºæ•°æ®åº“

```sh
CREATE USER 'ldap'@'localhost' IDENTIFIED BY 'Eryajf@123';

CREATE DATABASE IF NOT EXISTS `go_ldap_admin` CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;

GRANT ALL PRIVILEGES on `go_ldap_admin`.* to 'ldap'@'localhost';

FLUSH privileges;
```

### å®‰è£…openLDAP

1:ä½¿ç”¨yumæ–¹å¼å®‰è£…

```sh
yum install openldap openldap-clients openldap-servers
```

2:å¤åˆ¶ä¸€ä¸ªé»˜è®¤é…ç½®åˆ°æŒ‡å®šç›®å½•ä¸‹,å¹¶æˆæƒï¼Œè¿™ä¸€æ­¥ä¸€å®šè¦åšï¼Œç„¶åå†å¯åŠ¨æœåŠ¡ï¼Œä¸ç„¶ç”Ÿäº§å¯†ç æ—¶ä¼šæŠ¥é”™

```sh
cp /usr/share/openldap-servers/DB_CONFIG.example /var/lib/ldap/DB_CONFIG
```

3:æˆæƒç»™ldapç”¨æˆ·,æ­¤ç”¨æˆ·yumå®‰è£…æ—¶ä¾¿ä¼šè‡ªåŠ¨åˆ›å»º

```sh
chown -R ldap /var/lib/ldap/DB_CONFIG
```

4:å¯åŠ¨æœåŠ¡ï¼Œå…ˆå¯åŠ¨æœåŠ¡ï¼Œé…ç½®åé¢å†è¿›è¡Œä¿®æ”¹

```sh
systemctl start slapd

systemctl enable slapd
```

æŸ¥çœ‹çŠ¶æ€ï¼Œæ­£å¸¸å¯åŠ¨åˆ™ok

```sh
systemctl status slapd
```

5:ä¿®æ”¹openldapé…ç½®

è¿™é‡Œå°±æ˜¯é‡ç‚¹ä¸­çš„é‡ç‚¹äº†ï¼Œä»openldap2.4.23ç‰ˆæœ¬å¼€å§‹ï¼Œæ‰€æœ‰é…ç½®éƒ½ä¿å­˜åœ¨`/etc/openldap/slapd.d`ç›®å½•ä¸‹çš„`cn=config`æ–‡ä»¶å¤¹å†…ï¼Œä¸å†ä½¿ç”¨`slapd.conf`ä½œä¸ºé…ç½®æ–‡ä»¶ã€‚é…ç½®æ–‡ä»¶çš„åç¼€ä¸º `ldif`ï¼Œä¸”æ¯ä¸ªé…ç½®æ–‡ä»¶éƒ½æ˜¯é€šè¿‡å‘½ä»¤è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œä»»æ„æ‰“å¼€ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œåœ¨å¼€å¤´éƒ½ä¼šæœ‰ä¸€è¡Œæ³¨é‡Šï¼Œè¯´æ˜æ­¤ä¸ºè‡ªåŠ¨ç”Ÿæˆçš„æ–‡ä»¶ï¼Œè¯·å‹¿ç¼–è¾‘ï¼Œä½¿ç”¨ldapmodifyå‘½ä»¤è¿›è¡Œä¿®æ”¹

---

6:å®‰è£…openldapåï¼Œä¼šæœ‰ä¸‰ä¸ªå‘½ä»¤ç”¨äºä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œåˆ†åˆ«ä¸ºldapadd, ldapmodify, ldapdeleteï¼Œé¡¾åæ€ä¹‰å°±æ˜¯æ·»åŠ ï¼Œä¿®æ”¹å’Œåˆ é™¤ã€‚è€Œéœ€è¦ä¿®æ”¹æˆ–å¢åŠ é…ç½®æ—¶ï¼Œåˆ™éœ€è¦å…ˆå†™ä¸€ä¸ªldifåç¼€çš„é…ç½®æ–‡ä»¶ï¼Œç„¶åé€šè¿‡å‘½ä»¤å°†å†™çš„é…ç½®æ›´æ–°åˆ°slapd.dç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶ä¸­å»

---

7ï¼šåˆå§‹åŒ–é…ç½®

ç”Ÿæˆç®¡ç†å‘˜å¯†ç ,è®°å½•ä¸‹è¿™ä¸ªå¯†ç ï¼Œ{SSHA}è¿™ä¸€ä¸²ï¼Œåé¢éœ€è¦ç”¨åˆ°

```sh
slappasswd -s 123456

{SSHA}LSgYPTUW4zjGtIVtuZ8cRUqqFRv1tWpE
```

æ–°å¢ä¿®æ”¹å¯†ç æ–‡ä»¶,ldifä¸ºåç¼€ï¼Œæ–‡ä»¶åéšæ„ï¼Œä¸è¦åœ¨/etc/openldap/slapd.d/ç›®å½•ä¸‹åˆ›å»ºç±»ä¼¼æ–‡ä»¶
ç”Ÿæˆçš„æ–‡ä»¶ä¸ºéœ€è¦é€šè¿‡å‘½ä»¤å»åŠ¨æ€ä¿®æ”¹ldapç°æœ‰é…ç½®ï¼Œå¦‚ä¸‹ï¼Œæˆ‘åœ¨å®¶ç›®å½•ä¸‹ï¼Œåˆ›å»ºæ–‡ä»¶

```sh
cd ~

vim changepwd.ldif

dn: olcDatabase={0}config,cn=config
changetype: modify
add: olcRootPW
olcRootPW: {SSHA}LSgYPTUW4zjGtIVtuZ8cRUqqFRv1tWpE


# è¿™é‡Œè§£é‡Šä¸€ä¸‹è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹ï¼š
# ç¬¬ä¸€è¡Œæ‰§è¡Œé…ç½®æ–‡ä»¶ï¼Œè¿™é‡Œå°±è¡¨ç¤ºæŒ‡å®šä¸º cn=config/olcDatabase={0}config æ–‡ä»¶ã€‚
# ä½ åˆ°/etc/openldap/slapd.d/ç›®å½•ä¸‹å°±èƒ½æ‰¾åˆ°æ­¤æ–‡ä»¶
# ç¬¬äºŒè¡Œ changetype æŒ‡å®šç±»å‹ä¸ºä¿®æ”¹
# ç¬¬ä¸‰è¡Œ add è¡¨ç¤ºæ·»åŠ  olcRootPW é…ç½®é¡¹
# ç¬¬å››è¡ŒæŒ‡å®š olcRootPW é…ç½®é¡¹çš„å€¼
# åœ¨æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å‰ï¼Œä½ å¯ä»¥å…ˆæŸ¥çœ‹åŸæœ¬çš„olcDatabase={0}configæ–‡ä»¶ï¼Œ
# é‡Œé¢æ˜¯æ²¡æœ‰olcRootPWè¿™ä¸ªé¡¹çš„ï¼Œæ‰§è¡Œå‘½ä»¤åï¼Œä½ å†çœ‹å°±ä¼šæ–°å¢äº†olcRootPWé¡¹ï¼Œ
# è€Œä¸”å†…å®¹æ˜¯æˆ‘ä»¬æ–‡ä»¶ä¸­æŒ‡å®šçš„å€¼åŠ å¯†åçš„å­—ç¬¦ä¸²
```

æ‰§è¡Œå‘½ä»¤ï¼Œä¿®æ”¹ldapé…ç½®ï¼Œé€šè¿‡-fæ‰§è¡Œæ–‡ä»¶

```sh
ldapadd -Y EXTERNAL -H ldapi:/// -f changepwd.ldif
```


æŸ¥çœ‹`olcDatabase={0}config`å†…å®¹,æ–°å¢äº†ä¸€ä¸ª`olcRootPW`é¡¹ã€‚

```sh
cat /etc/openldap/slapd.d/cn=config/olcDatabase={0}config.ldif
```

**åˆ‡è®°ä¸èƒ½ç›´æ¥ä¿®æ”¹/etc/openldap/slapd.d/ç›®å½•ä¸‹çš„é…ç½®ã€‚**

---

æˆ‘ä»¬éœ€è¦å‘ LDAP ä¸­å¯¼å…¥ä¸€äº›åŸºæœ¬çš„ Schemaã€‚è¿™äº› Schema æ–‡ä»¶ä½äº`/etc/openldap/schema/`ç›®å½•ä¸­ï¼Œschemaæ§åˆ¶ç€æ¡ç›®æ‹¥æœ‰å“ªäº›å¯¹è±¡ç±»å’Œå±æ€§ï¼Œå¯ä»¥è‡ªè¡Œé€‰æ‹©éœ€è¦çš„è¿›è¡Œå¯¼å…¥ï¼Œ

```sh
ä¾æ¬¡æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œå¯¼å…¥åŸºç¡€çš„ä¸€äº›é…ç½®,æˆ‘è¿™é‡Œå°†æ‰€æœ‰çš„éƒ½å¯¼å…¥ä¸€ä¸‹ï¼Œ
å…¶ä¸­core.ldifæ˜¯é»˜è®¤å·²ç»åŠ è½½äº†çš„ï¼Œä¸ç”¨å¯¼å…¥

ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/cosine.ldif

ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/nis.ldif
ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/inetorgperson.ldif

ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/collective.ldif
ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/corba.ldif
ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/duaconf.ldif
ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/dyngroup.ldif
ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/java.ldif
ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/misc.ldif
ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/openldap.ldif
ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/pmi.ldif
ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/ppolicy.ldif
```

#### ä¿®æ”¹åŸŸåï¼Œæ–°å¢con.ldif,
è¿™é‡Œæˆ‘è‡ªå®šä¹‰çš„åŸŸåä¸º eryajf.netï¼Œç®¡ç†å‘˜ç”¨æˆ·è´¦å·ä¸ºadminã€‚
å¦‚æœè¦ä¿®æ”¹ï¼Œåˆ™ä¿®æ”¹æ–‡ä»¶ä¸­ç›¸åº”çš„dc=eryajf,dc=netä¸ºè‡ªå·±çš„åŸŸåï¼Œå¯†ç åˆ‡è®°æ”¹æˆä¸Šé¢é‡æ–°ç”Ÿæˆçš„å“ªä¸ªã€‚

```sh
$ vim con.ldif

dn: olcDatabase={1}monitor,cn=config
changetype: modify
replace: olcAccess
olcAccess: {0}to * by dn.base="gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth" read by dn.base="cn=admin,dc=eryajf,dc=net" read by * none

dn: olcDatabase={2}hdb,cn=config
changetype: modify
replace: olcSuffix
olcSuffix: dc=eryajf,dc=net

dn: olcDatabase={2}hdb,cn=config
changetype: modify
replace: olcRootDN
olcRootDN: cn=admin,dc=eryajf,dc=net

dn: olcDatabase={2}hdb,cn=config
changetype: modify
replace: olcRootPW
olcRootPW: {SSHA}LSgYPTUW4zjGtIVtuZ8cRUqqFRv1tWpE

dn: olcDatabase={2}hdb,cn=config
changetype: modify
add: olcAccess
olcAccess: {0}to attrs=userPassword,shadowLastChange by dn="cn=admin,dc=eryajf,dc=net" write by anonymous auth by self write by * none
olcAccess: {1}to dn.base="" by * read
olcAccess: {2}to * by dn="cn=admin,dc=eryajf,dc=net" write by * read
```

æ‰§è¡Œå‘½ä»¤ï¼Œä¿®æ”¹é…ç½®

```sh
ldapmodify -Y EXTERNAL -H ldapi:/// -f con.ldif
```

æœ€åè¿™é‡Œæœ‰5ä¸ªä¿®æ”¹ï¼Œæ‰€ä»¥æ‰§è¡Œä¼šè¾“å‡º5è¡Œè¡¨ç¤ºæˆåŠŸã€‚

ç„¶åï¼Œå¯ç”¨memberofåŠŸèƒ½

æ–°å¢add-memberof.ldif, #å¼€å¯memberofæ”¯æŒå¹¶æ–°å¢ç”¨æˆ·æ”¯æŒmemberofé…ç½®

```sh
# æ–°å¢add-memberof.ldif, #å¼€å¯memberofæ”¯æŒå¹¶æ–°å¢ç”¨æˆ·æ”¯æŒmemberofé…ç½®
$ vim add-memberof.ldif

dn: cn=module{0},cn=config
cn: modulle{0}
objectClass: olcModuleList
objectclass: top
olcModuleload: memberof.la
olcModulePath: /usr/lib64/openldap

dn: olcOverlay={0}memberof,olcDatabase={2}hdb,cn=config
objectClass: olcConfig
objectClass: olcMemberOf
objectClass: olcOverlayConfig
objectClass: top
olcOverlay: memberof
olcMemberOfDangling: ignore
olcMemberOfRefInt: TRUE
olcMemberOfGroupOC: groupOfUniqueNames
olcMemberOfMemberAD: uniqueMember
olcMemberOfMemberOfAD: memberOf
```
-------------------------------------------------------------
```sh
# æ–°å¢refint1.ldifæ–‡ä»¶
$ vim refint1.ldif

dn: cn=module{0},cn=config
add: olcmoduleload
olcmoduleload: refint
```
-------------------------------------------------------------
```sh
# æ–°å¢refint2.ldifæ–‡ä»¶
$ vim refint2.ldif

dn: olcOverlay=refint,olcDatabase={2}hdb,cn=config
objectClass: olcConfig
objectClass: olcOverlayConfig
objectClass: olcRefintConfig
objectClass: top
olcOverlay: refint
olcRefintAttribute: memberof uniqueMember  manager owner
```
-------------------------------------------------------------

**ä¾æ¬¡æ‰§è¡Œä¸‹é¢å‘½ä»¤ï¼ŒåŠ è½½é…ç½®ï¼Œé¡ºåºä¸èƒ½é”™**

```sh
ldapadd -Q -Y EXTERNAL -H ldapi:/// -f add-memberof.ldif
```
---

```sh
ldapmodify -Q -Y EXTERNAL -H ldapi:/// -f refint1.ldif
```
---

```sh
ldapadd -Q -Y EXTERNAL -H ldapi:/// -f refint2.ldif
```
---

**åˆ›å»ºä¸€ä¸ªç»„ç»‡**

åˆ°æ­¤ï¼Œé…ç½®ä¿®æ”¹å®Œäº†,åœ¨ä¸Šè¿°åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªå«åš eryajf company çš„ç»„ç»‡ï¼Œå¹¶åœ¨å…¶ä¸‹åˆ›å»ºä¸€ä¸ª admin çš„ç»„ç»‡è§’è‰²ï¼ˆè¯¥ç»„ç»‡è§’è‰²å†…çš„ç”¨æˆ·å…·æœ‰ç®¡ç†æ•´ä¸ª LDAP çš„æƒé™ï¼‰å’Œ ä¸€äº›åˆå§‹åŒ–å¿…é¡»çš„ç»„ç»‡ï¼š

----------------------------------------------------------
```sh
# æ–°å¢é…ç½®æ–‡ä»¶
$ vim base.ldif

dn: dc=eryajf,dc=net
objectClass: top
objectClass: dcObject
objectClass: organization
o: Eryajf Company
dc: eryajf

dn: cn=admin,dc=eryajf,dc=net
objectClass: organizationalRole
cn: admin

dn: ou=people,dc=eryajf,dc=net
ou: people
description: ç”¨æˆ·æ ¹ç›®å½•
objectClass: organizationalUnit

dn: ou=dingtalkroot,dc=eryajf,dc=net
ou: dingtalkroot
description: é’‰é’‰æ ¹éƒ¨é—¨
objectClass: top
objectClass: organizationalUnit

dn: ou=wecomroot,dc=eryajf,dc=net
ou: wecomroot
description: ä¼ä¸šå¾®ä¿¡æ ¹éƒ¨é—¨
objectClass: top
objectClass: organizationalUnit

dn: ou=feishuroot,dc=eryajf,dc=net
ou: feishuroot
description: é£ä¹¦æ ¹éƒ¨é—¨
objectClass: top
objectClass: organizationalUnit
```
----------------------------------------------------------

è¿™é‡Œæ³¨æ„ï¼Œå¯ä»¥æŠŠeryajfå’Œnetæ”¹æˆè‡ªå·±çš„

 æ‰§è¡Œå‘½ä»¤ï¼Œæ·»åŠ é…ç½®, è¿™é‡Œè¦æ³¨æ„ä¿®æ”¹åŸŸåä¸ºè‡ªå·±é…ç½®çš„åŸŸåï¼Œç„¶åéœ€è¦è¾“å…¥ä¸Šé¢æˆ‘ä»¬ç”Ÿæˆçš„å¯†ç `123456`

```sh
ldapadd -x -D cn=admin,dc=yaobili,dc=com -W -f base.ldif
```

## å®‰è£…OpenResty

é…ç½®é˜¿é‡Œå’Œopenrestyçš„yumæºï¼š

```sh
$ yum -y install yum-utils

$ yum-config-manager --add-repo http://mirrors.aliyun.com/repo/Centos-7.repo

$ yum-config-manager --add-repo https://openresty.org/package/centos/openresty.repo
```


å®‰è£…

```sh
yum install openresty
```

åˆ›å»ºä¸€äº›è½¯é“¾ï¼Œä¾¿äºç»´æŠ¤æˆ–è€…è§„èŒƒ

```sh
ln -snf /usr/local/openresty/nginx/sbin/nginx /usr/sbin/nginx

ln -snf /usr/local/openresty/nginx/conf /etc/nginx
```

å¯åŠ¨æœåŠ¡

```sh
systemctl start openresty

systemctl status openresty
```

## ä¸‹è½½å‰åç«¯åˆ¶å“


### åç«¯

ä½ å¯ä»¥åœ¨[è¿™é‡Œ](https://github.com/eryajf/go-ldap-admin/releases)æ‰¾åˆ°æœ€æ–°ç‰ˆæœ¬ï¼š

```sh
$ wget https://github.com/eryajf/go-ldap-admin/releases/download/v0.5.9/go-ldap-admin-v0.5.9-linux-amd64.tar.gz
$ tar xf go-ldap-admin-v0.5.9-linux-amd64.tar.gz
```

å…¶ä¸­åç«¯åˆ¶å“è§£å‹ä¹‹åï¼ŒåŒ…å«å†…å®¹å¦‚ä¸‹ï¼š

```sh
$ tree -N
.
â”œâ”€â”€ LICENSE
â”œâ”€â”€ README.md
â”œâ”€â”€ config.yml
â”œâ”€â”€ go-ldap-admin
â”œâ”€â”€ go-ldap-admin-priv.pem
â”œâ”€â”€ go-ldap-admin-pub.pem
â”œâ”€â”€ go-ldap-admin-v0.5.9-linux-amd64.tar.gz
â””â”€â”€ rbac_model.conf

0 directories, 8 files
```

### å‰ç«¯

ä½ å¯ä»¥åœ¨[è¿™é‡Œ](https://github.com/eryajf/go-ldap-admin-ui/releases)æ‰¾åˆ°æœ€æ–°ç‰ˆæœ¬ï¼š

```sh
$ wget https://github.com/eryajf/go-ldap-admin-ui/releases/download/v0.5.12/go-ldap-admin-ui-v0.5.12.tar.gz
$ tar xf go-ldap-admin-ui-v0.5.12.tar.gz
```

å‰ç«¯åˆ¶å“è§£å‹ä¹‹åï¼ŒåŒ…å«å†…å®¹å¦‚ä¸‹ï¼š

```sh
$ tree -N go-ldap-admin-ui
go-ldap-admin-ui
â”œâ”€â”€ LICENSE
â”œâ”€â”€ README.md
â”œâ”€â”€ default.conf
â””â”€â”€ dist
    â”œâ”€â”€ favicon.ico
    â”œâ”€â”€ goldapadmin.ico
    â”œâ”€â”€ index.html
    â””â”€â”€ static
        â”œâ”€â”€ css
        â”‚   â”œâ”€â”€ app.002b83d7.css
        â”‚   â”œâ”€â”€ ç­‰ç­‰========ç­‰ç­‰
        â”‚   â””â”€â”€ chunk-libs.3dfb7769.css
        â”œâ”€â”€ fonts
        â”‚   â”œâ”€â”€ element-icons.535877f5.woff
        â”‚   â””â”€â”€ element-icons.732389de.ttf
        â”œâ”€â”€ img
        â”‚   â”œâ”€â”€ 401.089007e7.gif
        â”‚   â”œâ”€â”€ 404.a57b6f31.png
        â”‚   â”œâ”€â”€ 404_cloud.0f4bc32b.png
        â”‚   â”œâ”€â”€ goldapadmin.ecbc528a.png
        â”‚   â””â”€â”€ login.e49a1d4c.jpeg
        â””â”€â”€ js
            â”œâ”€â”€ app.2b71e8e0.js
            â”œâ”€â”€ ç­‰ç­‰========ç­‰ç­‰
            â””â”€â”€ chunk-libs.43b732db.js

6 directories, 39 files
```

## éƒ¨ç½²åç«¯

å°†åˆ¶å“æ”¾ç½®åˆ°é¡¹ç›®è¿è¡Œç›®å½•ï¼š

```sh
mv go-ldap-admin /data/www
```

æ›´æ”¹é…ç½®ï¼Œæ ¹æ®å®é™…æƒ…å†µè°ƒæ•´é…ç½®æ–‡ä»¶å†…å®¹

```sh
vim config.yml
```

ä¿®æ”¹æ•°æ®åº“ä¿¡æ¯å’ŒLDAPè¿æ¥ä¿¡æ¯ã€‚


systemdç®¡ç†ï¼ŒåŸºäºsystemdè¿›è¡Œç®¡ç†

---
```sh
$ cat /usr/lib/systemd/system/go-ldap-admin.service

[Unit]
Description=Go Ldap Admin Service

[Service]
WorkingDirectory=/data/www/go-ldap-admin/
ExecStart=/data/www/go-ldap-admin/go-ldap-admin
Restart=always
RestartSec=10s
StartLimitInterval=65s
StartLimitBurst=6

[Install]
WantedBy=multi-user.target
```


å¯åŠ¨é¡¹ç›®

```sh
$ systemctl daemon-reload

$ systemctl start go-ldap-admin

$ systemctl status go-ldap-admin
```

## éƒ¨ç½²å‰ç«¯

å°†å‰ç«¯åˆ¶å“æ”¾ç½®åˆ°é™æ€ç›®å½•ä¸‹ï¼š

```sh
mv go-ldap-admin-ui /data/www//demo-go-ldap-admin.eryajf.net
```

å‰ç«¯é€šè¿‡OpenRestyä»£ç†çš„æ–¹å¼è¿›è¡Œéƒ¨ç½²ã€‚

**åœ¨OpenRestyä¸­æ·»åŠ å¦‚ä¸‹é…ç½®ï¼Œä»£ç†æœ¬é¡¹ç›®**


---
```nginx
$ cat /etc/nginx/conf/nginx.conf

worker_processes  1;
events {
worker_connections  1024;
}

http {
include       mime.types;
default_type  application/octet-stream;
sendfile        on;

keepalive_timeout  65;
  server {
    listen 80;
    server_name demo-go-ldap-admin.eryajf.net;
    root /data/www//demo-go-ldap-admin.eryajf.net/dist;
    location / {
        try_files $uri $uri/ /index.html;
        add_header Cache-Control 'no-store';
    }

    location /api/ {
        proxy_set_header Host $http_host;
        proxy_set_header  X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_pass http://127.0.0.1:8888;
    }
  }
}
```

æ£€æŸ¥ä¸€ä¸‹å‡ ä¸ªæœåŠ¡æ˜¯å¦éƒ½å¼€å¯

`æ•°æ®åº“`

```sh
systemctl status mysqld
```

`LDAP`

```sh
systemctl status slapd
```

`åç«¯`

```sh
systemctl status go-ldap-admin
```

`ä»£ç†`

```sh
systemctl status openresty
```

éƒ½å¯åŠ¨ä¹‹åï¼Œå°±å¯ä»¥æ‰“å¼€webç®¡ç†é¡µé¢

`http:ip:ç«¯å£`

é»˜è®¤ç”¨æˆ·åï¼šadminï¼Œé»˜è®¤å¯†ç æ˜¯LDAPè®¾ç½®çš„å¯†ç ã€‚
