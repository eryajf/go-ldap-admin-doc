---
title: docker-composeåœ¨æœ¬åœ°å¿«é€Ÿæ‹‰èµ·æµ‹è¯•ç¯å¢ƒ
date: 2022-06-04 10:46:09
permalink: /pages/f081dc/
---

## å‰è¨€

ä½ å¯ä»¥é€šè¿‡docker-composeåœ¨æœ¬åœ°å¿«é€Ÿæ‹‰èµ·è¿›è¡Œä½“éªŒã€‚

å¿«é€Ÿæ‹‰èµ·çš„å®¹å™¨åŒ…æ‹¬ï¼š

- MySQL-8.3
- openLDAP-1.4.0
- phpldapadmin-0.9.0
- go-ldap-admin-server


## ç«¯å£åˆ—è¡¨

æœåŠ¡ç«¯å£æ˜ å°„å¦‚ä¸‹ï¼š

|    Service    | Port(å®¿ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£) |
| :-----------: | :-----------------------: |
|     MySQL     |        `3307:3306`        |
|   openLDAP    |         `389:389`         |
| phpldapadmin  |         `8091:80`         |
| go-ldap-admin |        `8888:8888`        |

æ‹‰èµ·ä¹‹å‰ç¡®è®¤æ˜¯å¦æœ‰ä¸æœ¬åœ°ç«¯å£å†²çªçš„æƒ…å†µã€‚

## ä½¿ç”¨ sqlite å­˜å‚¨æ•°æ®

åœ¨ä½ åˆé€‚çš„ç›®å½•ä¸­åˆ›å»º`go-ldap-admin`æ–‡ä»¶å¤¹ï¼Œç„¶ååˆ›å»º`docker-compose.yaml`æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```yaml
version: '3'
networks:
  go-ldap-admin:
    driver: bridge
services:
  go-ldap-admin:
    image: registry.cn-hangzhou.aliyuncs.com/ali_eryajf/go-ldap-admin
    container_name: go-ldap-admin
    hostname: go-ldap-admin
    restart: always
    environment:
      WAIT_HOSTS: openldap:389
      DB_DRIVER: sqlite3
    ports:
      - 8888:8888
    volumes:
      - ./data/go-ldap-admin:/app/data
    depends_on:
      - openldap
    links:
      - openldap:go-ldap-admin-openldap
    networks:
      - go-ldap-admin

  openldap:
    image: registry.cn-hangzhou.aliyuncs.com/ali_eryajf/openldap:1.4.1
    container_name: go-ldap-admin-openldap
    hostname: go-ldap-admin-openldap
    restart: always
    environment:
      TZ: Asia/Shanghai
      LDAP_ORGANISATION: "eryajf.net"
      LDAP_DOMAIN: "eryajf.net"
      LDAP_ADMIN_PASSWORD: "123456"
    command: [ '--copy-service' ]
    volumes:
      - ./data/openldap/database:/var/lib/ldap
      - ./data/openldap/config:/etc/ldap/slapd.d
    ports:
      - 388:389
    networks:
      - go-ldap-admin

  phpldapadmin:
    image: registry.cn-hangzhou.aliyuncs.com/ali_eryajf/phpldapadmin:0.9.0
    container_name: go-ldap-admin-phpldapadmin
    hostname: go-ldap-admin-phpldapadmin
    restart: always
    environment:
      TZ: Asia/Shanghai
      PHPLDAPADMIN_HTTPS: "false"
      PHPLDAPADMIN_LDAP_HOSTS: go-ldap-admin-openldap
    ports:
      - 8091:80
    volumes:
      - ./data/phpadmin:/var/www/phpldapadmin
    depends_on:
      - openldap
    links:
      - openldap:go-ldap-admin-openldap
    networks:
      - go-ldap-admin
```

æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ä½¿å®¹å™¨åå°å¯åŠ¨ï¼š

```sh
$ docker-compose up -d
```

åº”ç”¨å¯åŠ¨ä¹‹åï¼Œé»˜è®¤ä¼šåˆ›å»ºå¯¹åº”çš„åˆå§‹åŒ–æ•°æ®ï¼Œé€šè¿‡æ—¥å¿—å¯ä»¥æŸ¥çœ‹æ•°æ®æ˜¯å¦æ­£å¸¸åˆå§‹åŒ–ï¼Œå¦‚æœæ²¡æœ‰æ­£å¸¸åˆå§‹åŒ–ï¼Œåˆ™ä¸‹è¾¹çš„ç™»é™†å¯èƒ½æ— æ³•æ­£å¸¸è¿›è¡Œã€‚

å½“çœ‹åˆ°å®¹å™¨éƒ½æ­£å¸¸è¿è¡Œä¹‹åï¼Œå¯ä»¥åœ¨æœ¬åœ°è¿›è¡Œè®¿é—®ï¼šhttp://localhost:8888ï¼Œç”¨æˆ·å/å¯†ç ï¼š`admin`/`123456`

å¦‚æœæƒ³è¦è®¿é—®PhpLdapAdminï¼Œåˆ™å¯è®¿é—®ï¼šhttp://localhost:8091ï¼Œç”¨æˆ·å/å¯†ç ï¼š`cn=admin,dc=eryajf,dc=net`/`123456`

> å¦‚æœå¹¶éé€šè¿‡localhostæœ¬æœºéƒ¨ç½²ï¼Œåˆ™ä½¿ç”¨å¯¹åº”ä¸»æœºçš„IPåŠ ç«¯å£è¿›è¡Œè®¿é—®å³å¯ï¼Œä¾‹å¦‚ä½ éƒ¨ç½²åœ¨ 192.168.10.10 è¿™å°ä¸»æœºï¼Œåˆ™å‰ç«¯è®¿é—®åœ°å€åº”è¯¥ä¸ºï¼šhttp://192.168.10.10:8888

## ä½¿ç”¨ MySQL å­˜å‚¨æ•°æ®

### docker-composeé›†æˆMySQL

åœ¨ä½ åˆé€‚çš„ç›®å½•ä¸­åˆ›å»º`go-ldap-admin`æ–‡ä»¶å¤¹ï¼Œç„¶ååˆ›å»º`docker-compose.yaml`æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```yaml
version: '3'
networks:
  go-ldap-admin:
    driver: bridge
services:
  go-ldap-admin:
    image: registry.cn-hangzhou.aliyuncs.com/ali_eryajf/go-ldap-admin
    container_name: go-ldap-admin
    hostname: go-ldap-admin
    restart: always
    environment:
      WAIT_HOSTS: mysql:3306, openldap:389
    ports:
      - 8888:8888
    volumes:
      - ./data/go-ldap-admin:/app/data
    depends_on:
      - mysql
      - openldap
    links:
      - mysql:go-ldap-admin-mysql
      - openldap:go-ldap-admin-openldap
    networks:
      - go-ldap-admin

  mysql:
    image: registry.cn-hangzhou.aliyuncs.com/ali_eryajf/mysql:8.3
    container_name: go-ldap-admin-mysql
    hostname: go-ldap-admin-mysql
    restart: always
    ports:
      - '3307:3306'
    environment:
      TZ: Asia/Shanghai
      MYSQL_ROOT_PASSWORD: 123456
      MYSQL_ROOT_HOST: "%"
      MYSQL_DATABASE: go_ldap_admin
    volumes:
      - ./data/mysql:/var/lib/mysql
    networks:
      - go-ldap-admin

  openldap:
    image: registry.cn-hangzhou.aliyuncs.com/ali_eryajf/openldap:1.4.1
    container_name: go-ldap-admin-openldap
    hostname: go-ldap-admin-openldap
    restart: always
    environment:
      TZ: Asia/Shanghai
      LDAP_ORGANISATION: "eryajf.net"
      LDAP_DOMAIN: "eryajf.net"
      LDAP_ADMIN_PASSWORD: "123456"
    command: [ '--copy-service' ]
    volumes:
      - ./data/openldap/database:/var/lib/ldap
      - ./data/openldap/config:/etc/ldap/slapd.d
    ports:
      - 388:389
    networks:
      - go-ldap-admin

  phpldapadmin:
    image: registry.cn-hangzhou.aliyuncs.com/ali_eryajf/phpldapadmin:0.9.0
    container_name: go-ldap-admin-phpldapadmin
    hostname: go-ldap-admin-phpldapadmin
    restart: always
    environment:
      TZ: Asia/Shanghai
      PHPLDAPADMIN_HTTPS: "false"
      PHPLDAPADMIN_LDAP_HOSTS: go-ldap-admin-openldap
    ports:
      - 8091:80
    volumes:
      - ./data/phpadmin:/var/www/phpldapadmin
    depends_on:
      - openldap
    links:
      - openldap:go-ldap-admin-openldap
    networks:
      - go-ldap-admin
```

### ä½¿ç”¨å¤–ç½®MySQL

åœ¨ä½ åˆé€‚çš„ç›®å½•ä¸­åˆ›å»º`go-ldap-admin`æ–‡ä»¶å¤¹ï¼Œç„¶ååˆ›å»º`docker-compose.yaml`æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

> **`ğŸ“¢ æ³¨æ„`**ï¼šéœ€æå‰åˆ›å»ºæ•°æ®åº“åŠç”¨æˆ·ï¼Œå¹¶ä¿®æ”¹å¦‚ä¸‹é…ç½®ä¿¡æ¯ï¼Œæ³¨æ„go-ldap-adminå®¹å™¨è¦èƒ½å¤Ÿè¿ä¸Š`MYSQL_HOST`ã€‚

```yaml
version: '3'
networks:
  go-ldap-admin:
    driver: bridge
services:
  go-ldap-admin:
    image: registry.cn-hangzhou.aliyuncs.com/ali_eryajf/go-ldap-admin
    container_name: go-ldap-admin
    hostname: go-ldap-admin
    restart: always
    environment:
      WAIT_HOSTS: openldap:389
      DB_DRIVER: mysql
      # è¯·ä¿®æ”¹ä¸‹é¢çš„ MySql é…ç½®ï¼Œéœ€è‡ªè¡Œåˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·
      MYSQL_HOST: example
      MYSQL_PORT: 3306
      MYSQL_USERNAME: root
      MYSQL_PASSWORD: 123456
      MYSQL_DATABASE: go_ldap_admin
    ports:
      - 8888:8888
    volumes:
      - ./data/go-ldap-admin:/app/data
    depends_on:
      - openldap
    links:
      - openldap:go-ldap-admin-openldap
    networks:
      - go-ldap-admin

  openldap:
    image: registry.cn-hangzhou.aliyuncs.com/ali_eryajf/openldap:1.4.1
    container_name: go-ldap-admin-openldap
    hostname: go-ldap-admin-openldap
    restart: always
    environment:
      TZ: Asia/Shanghai
      LDAP_ORGANISATION: "eryajf.net"
      LDAP_DOMAIN: "eryajf.net"
      LDAP_ADMIN_PASSWORD: "123456"
    command: [ '--copy-service' ]
    volumes:
      - ./data/openldap/database:/var/lib/ldap
      - ./data/openldap/config:/etc/ldap/slapd.d
    ports:
      - 388:389
    networks:
      - go-ldap-admin

  phpldapadmin:
    image: registry.cn-hangzhou.aliyuncs.com/ali_eryajf/phpldapadmin:0.9.0
    container_name: go-ldap-admin-phpldapadmin
    hostname: go-ldap-admin-phpldapadmin
    restart: always
    environment:
      TZ: Asia/Shanghai
      PHPLDAPADMIN_HTTPS: "false"
      PHPLDAPADMIN_LDAP_HOSTS: go-ldap-admin-openldap
    ports:
      - 8091:80
    volumes:
      - ./data/phpadmin:/var/www/phpldapadmin
    depends_on:
      - openldap
    links:
      - openldap:go-ldap-admin-openldap
    networks:
      - go-ldap-admin
```

é…ç½®ä¹‹åå¯åŠ¨å‘½ä»¤åŠè®¿é—®æ–¹å¼åŒä¸Šã€‚